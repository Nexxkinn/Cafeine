<mvvm:BasePage
    x:Class="Cafeine.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conv="using:Cafeine.Models.Conversions"
    xmlns:core="using:Microsoft.Xaml.Interactions.Core"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:local="using:Cafeine"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:reactiveProperty="using:Reactive.Bindings.Interactivity"
    xmlns:mvvm="using:Cafeine.Services.Mvvm"
    xmlns:vm="using:Cafeine.ViewModels"
    xmlns:views="using:Cafeine.Views"
    xmlns:vr="using:Cafeine.Views.Resources"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    NavigationCacheMode="Enabled"
    mc:Ignorable="d">
    <mvvm:BasePage.DataContext>
        <vm:MainPageViewModel/>
    </mvvm:BasePage.DataContext>
    <interactivity:Interaction.Behaviors>
        <core:EventTriggerBehavior EventName="Loaded">
            <reactiveProperty:EventToReactiveCommand Command="{x:Bind Path=Vm.MainPageLoaded}" />
        </core:EventTriggerBehavior>
    </interactivity:Interaction.Behaviors>
    <mvvm:BasePage.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <vr:Template />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </mvvm:BasePage.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <GridView
            x:Name="collection"
            Grid.RowSpan="2"
            Margin="28,0,0,0"
            Canvas.ZIndex="-1"
            IsItemClickEnabled="True"
            ItemContainerStyle="{StaticResource CollectionItemContainerStyle}"
            ItemTemplate="{StaticResource Collection}"
            ContainerContentChanging="Collection_ContainerContentChanging"
            ItemsSource="{x:Bind Vm.Library, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
            Template="{StaticResource CustomizedCollectionGridView}">
            <GridView.Header>
                <Grid Height="40" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
                    <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                        <ComboBox
                            Margin="8,0"
                            Header="Sort by:"
                            LightDismissOverlayMode="On"
                            SelectedIndex="{x:Bind Vm.SortBy.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            Template="{StaticResource CustomizedComboBox}">
                            <ComboBoxItem Content="A to Z" />
                            <ComboBoxItem Content="Z to A" />
                            <ComboBoxItem Content="Date Added" IsEnabled="False" />
                        </ComboBox>
                        <ComboBox
                            Margin="8,0"
                            Header="Filter:"
                            LightDismissOverlayMode="On"
                            SelectedIndex="{x:Bind Vm.FilterBy.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            Template="{StaticResource CustomizedComboBox}">
                            <ComboBoxItem Content="All" />
                            <ComboBoxItem Content="Finished Airing" />
                            <ComboBoxItem Content="Currently Airing" />
                            <ComboBoxItem Content="Not Yet Airing" />
                        </ComboBox>
                        <ComboBox
                            Margin="8,0"
                            Header="Type:"
                            IsEnabled="False"
                            LightDismissOverlayMode="On"
                            SelectedIndex="0"
                            Template="{StaticResource CustomizedComboBox}">
                            <ComboBoxItem Content="Anime" />
                            <ComboBoxItem Content="Manga" />
                            <ComboBoxItem Content="All" />
                            <ComboBoxItem Content="Both" />
                        </ComboBox>
                    </StackPanel>
                </Grid>
            </GridView.Header>
            <interactivity:Interaction.Behaviors>
                <core:EventTriggerBehavior EventName="ItemClick">
                    <reactiveProperty:EventToReactiveCommand Command="{x:Bind Path=Vm.ItemClicked}">
                        <conv:ItemClickToItemLibraryModel />
                    </reactiveProperty:EventToReactiveCommand>
                </core:EventTriggerBehavior>
            </interactivity:Interaction.Behaviors>
        </GridView>
    </Grid>
</mvvm:BasePage>
